\documentclass[acmsmall,screen,prologue,dvipsnames,style=authoryear]{acmart}

\bibliographystyle{ACM-Reference-Format}
\setcitestyle{authoryear}

\usepackage{colortbl}
\usepackage{xargs}
\usepackage{lipsum}
\usepackage[textsize=tiny]{todonotes}
\usepackage{xparse}
\usepackage{xifthen, xstring}
\usepackage[normalem]{ulem}
\usepackage{xspace}
\usepackage{marginnote}
\usepackage{etoolbox}
\usepackage{subcaption}
\usepackage{bbding}
\usepackage{pifont}
\let\Cross\undefined % conflict because marvosym also defines it
\usepackage{marvosym}
\usepackage{bussproofs}
\usepackage{supertabular}
%\usepackage{xtab}
\usepackage{ottlayout}

\usepackage{tikz-cd}
\usepackage{fancyvrb}

\usepackage[capitalize, nameinlink]{cleveref}
\newcommand{\crefrangeconjunction}{--}
\newcommand{\creflastconjunction}{, and~}

\usepackage{etoolbox}

\makeatletter

% Patch case where name and year are separated by aysep
\patchcmd{\NAT@citex}
  {\@citea\NAT@hyper@{%
     \NAT@nmfmt{\NAT@nm}%
     \hyper@natlinkbreak{\NAT@aysep\NAT@spacechar}{\@citeb\@extra@b@citeb}%
     \NAT@date}}
  {\@citea\NAT@nmfmt{\NAT@nm}%
   \NAT@aysep\NAT@spacechar\NAT@hyper@{\NAT@date}}{}{}

% Patch case where name and year are separated by opening bracket
\patchcmd{\NAT@citex}
  {\@citea\NAT@hyper@{%
     \NAT@nmfmt{\NAT@nm}%
     \hyper@natlinkbreak{\NAT@spacechar\NAT@@open\if*#1*\else#1\NAT@spacechar\fi}%
       {\@citeb\@extra@b@citeb}%
     \NAT@date}}
  {\@citea\NAT@nmfmt{\NAT@nm}%
   \NAT@spacechar\NAT@@open\if*#1*\else#1\NAT@spacechar\fi\NAT@hyper@{\NAT@date}}
  {}{}

\makeatother

\author[L. Xia]{Li-yao Xia}
\email{ly.xia@ed.ac.uk}
\affiliation{
  \institution{University of Edinburgh}
  \city{Edinburgh}\country{United Kingdom}
}

% Latex seems to expect the author list abbreviation here...
\author[P. Wadler]{Philip Wadler}
\email{wadler@inf.ed.ac.uk}
\affiliation{
  \institution{University of Edinburgh}
  \city{Edinburgh}\country{United Kingdom}
}

\title{Gradual types for effect handlers}

\include{paper/geff}

\begin{document}

\maketitle

\input{paper/core.tex}
\bibliography{references}

\end{document}
