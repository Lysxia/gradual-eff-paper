% generated by Ott 0.33 from: paper/geff.ott
\newcommand{\GEdrule}[4][]{{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}\quad\GEdrulename{#4}}}
\newcommand{\GEusedrule}[1]{\[#1\]}
\newcommand{\GEpremise}[1]{ #1 \\}
\newenvironment{GEdefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]}{}
\newenvironment{GEfundefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]\begin{displaymath}\begin{array}{l}}{\end{array}\end{displaymath}}
\newcommand{\GEfunclause}[2]{ #1 \equiv #2 \\}
\newcommand{\GEnt}[1]{\mathit{#1}}
\newcommand{\GEmv}[1]{\mathit{#1}}
\newcommand{\GEkw}[1]{\mathbf{#1}}
\newcommand{\GEsym}[1]{#1}
\newcommand{\GEcom}[1]{\text{#1}}
\newcommand{\GEdrulename}[1]{\textsc{#1}}
\newcommand{\GEcomplu}[5]{\overline{#1}^{\,#2\in #3 #4 #5}}
\newcommand{\GEcompu}[3]{\overline{#1}^{\,#2<#3}}
\newcommand{\GEcomp}[2]{\overline{#1}^{\,#2}}
\newcommand{\GEgrammartabular}[1]{\begin{supertabular}{llcllllll}#1\end{supertabular}}
\newcommand{\GEmetavartabular}[1]{\begin{supertabular}{ll}#1\end{supertabular}}
\newcommand{\GErulehead}[3]{$#1$ & & $#2$ & & & \multicolumn{2}{l}{#3}}
\newcommand{\GEprodline}[6]{& & $#1$ & $#2$ & $#3 #4$ & $#5$ & $#6$}
\newcommand{\GEfirstprodline}[6]{\GEprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\GElongprodline}[2]{& & $#1$ & \multicolumn{4}{l}{$#2$}}
\newcommand{\GEfirstlongprodline}[2]{\GElongprodline{#1}{#2}}
\newcommand{\GEbindspecprodline}[6]{\GEprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\GEprodnewline}{\\}
\newcommand{\GEinterrule}{\\[5.0mm]}
\newcommand{\GEafterlastrule}{\\}
\newcommand{\GEmetavars}{
\GEmetavartabular{
 $ \GEmv{x} ,\, \GEmv{y} ,\, \GEmv{k} $ & \GEcom{Variables} \\
 $ \GEmv{op} $ & \GEcom{Operations} \\
 $ \kappa $ & \GEcom{Base types} \\
 $ \GEmv{i} ,\, \GEmv{j} ,\, \GEmv{n} $ &  \\
}}

\newcommand{\GEM}{
\GErulehead{\GEnt{M}  ,\ \GEnt{N}  ,\ \GEnt{L}}{::=}{\GEcom{Terms}}\GEprodnewline
\GEfirstprodline{|}{\GEmv{x}}{}{}{}{\GEcom{Variable}}\GEprodnewline
\GEprodline{|}{\GEnt{N} \, \GEnt{M}}{}{}{}{\GEcom{Application}}\GEprodnewline
\GEprodline{|}{\lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}}{}{}{}{\GEcom{Abstraction}}\GEprodnewline
\GEprodline{|}{\GEmv{k}}{}{}{}{\GEcom{Constant}}\GEprodnewline
\GEprodline{|}{\GEnt{M}  \GEsym{+}  \GEnt{N}}{}{}{}{\GEcom{Primitive function}}\GEprodnewline
\GEprodline{|}{\GEsym{()}}{}{}{}{\GEcom{Unit}}\GEprodnewline
\GEprodline{|}{ \GEnt{M}  \,\MVAt\,  {\pm a} }{}{}{}{\GEcom{Value cast}}\GEprodnewline
\GEprodline{|}{ \GEnt{M}  \,!\,  {\pm e} }{}{}{}{\GEcom{Effect cast}}\GEprodnewline
\GEprodline{|}{\GEnt{M} \, \Uparrow \, \GEnt{G}}{}{}{}{\GEcom{Box}}\GEprodnewline
\GEprodline{|}{\GEkw{blame}}{}{}{}{\GEcom{Blame}}\GEprodnewline
\GEprodline{|}{\GEmv{op}  \GEsym{(}  \GEnt{M}  \GEsym{)}}{}{}{}{\GEcom{Operation}}\GEprodnewline
\GEprodline{|}{\GEkw{handle} \, \GEnt{H} \, \GEnt{M}}{}{}{}{\GEcom{Handler}}}

\newcommand{\GEV}{
\GErulehead{\GEnt{V}  ,\ \GEnt{W}}{::=}{\GEcom{Values}}\GEprodnewline
\GEfirstprodline{|}{\lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}}{}{}{}{\GEcom{Abstraction}}\GEprodnewline
\GEprodline{|}{\GEmv{k}}{}{}{}{\GEcom{Constant}}\GEprodnewline
\GEprodline{|}{\GEnt{V} \, \Uparrow \, \GEnt{G}}{}{}{}{\GEcom{Box}}}

\newcommand{\GEH}{
\GErulehead{\GEnt{H}}{::=}{\GEcom{Handlers}}\GEprodnewline
\GEfirstprodline{|}{\GEkw{return} \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \GEsym{;}  \GEnt{opclause_{{\mathrm{1}}}} \, .. \, \GEnt{opclause_{\GEmv{n}}}}{}{}{}{\GEcom{HH}}}

\newcommand{\GEopclause}{
\GErulehead{\GEnt{opclause}}{::=}{}\GEprodnewline
\GEfirstprodline{|}{\GEmv{op} \, \GEmv{x} \, \GEmv{k}  \GEsym{.}  \GEnt{M}}{}{}{}{}}

\newcommand{\GEP}{
\GErulehead{\GEnt{P}  ,\ \GEnt{Q}}{::=}{\GEcom{Computation type}}\GEprodnewline
\GEfirstprodline{|}{\GEnt{A}  \,!\,  \GEnt{E}}{}{}{}{}}

\newcommand{\GEA}{
\GErulehead{\GEnt{A}  ,\ \GEnt{B}  ,\ \GEnt{C}}{::=}{\GEcom{Value type}}\GEprodnewline
\GEfirstprodline{|}{\star}{}{}{}{\GEcom{Dynamic type}}\GEprodnewline
\GEprodline{|}{\GEnt{A}  \rightarrow  \GEnt{P}}{}{}{}{\GEcom{Function type}}\GEprodnewline
\GEprodline{|}{\kappa}{}{}{}{\GEcom{Base type}}\GEprodnewline
\GEprodline{|}{\GEkw{unit}}{}{}{}{\GEcom{Unit type}}}

\newcommand{\GEG}{
\GErulehead{\GEnt{G}}{::=}{\GEcom{Ground type}}\GEprodnewline
\GEfirstprodline{|}{ \star \to \star \,!\, \mbox{\tiny\FiveStarOpen} }{}{}{}{}\GEprodnewline
\GEprodline{|}{\kappa}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEkw{unit}}{}{}{}{}}

\newcommand{\GEE}{
\GErulehead{\GEnt{E}  ,\ \GEnt{F}}{::=}{\GEcom{Effect}}\GEprodnewline
\GEfirstprodline{|}{\mbox{\tiny\FiveStarOpen}}{}{}{}{\GEcom{Dynamic effect}}\GEprodnewline
\GEprodline{|}{ \foriset{i}{n}{op_i} }{}{}{}{\GEcom{Static effect}}}

\newcommand{\GEpp}{
\GErulehead{{\pm p}}{::=}{\GEcom{Polarized computation cast}}\GEprodnewline
\GEfirstprodline{|}{\GEsym{+}  \GEnt{p}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEsym{-}  \GEnt{p}}{}{}{}{}}

\newcommand{\GEpa}{
\GErulehead{{\pm a}}{::=}{\GEcom{Polarized value cast}}\GEprodnewline
\GEfirstprodline{|}{\GEsym{+}  \GEnt{a}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEsym{-}  \GEnt{a}}{}{}{}{}}

\newcommand{\GEpe}{
\GErulehead{{\pm e}}{::=}{\GEcom{Polarized effect cast}}\GEprodnewline
\GEfirstprodline{|}{\GEsym{+}  \GEnt{e}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEsym{-}  \GEnt{e}}{}{}{}{}}

\newcommand{\GEp}{
\GErulehead{\GEnt{p}  ,\ \GEnt{q}  ,\ \GEnt{r}}{::=}{\GEcom{Computation cast}}\GEprodnewline
\GEfirstprodline{|}{\GEnt{a}  \,!\,  \GEnt{e}}{}{}{}{}}

\newcommand{\GEa}{
\GErulehead{\GEnt{a}  ,\ \GEnt{b}  ,\ \GEnt{c}}{::=}{\GEcom{Value cast}}\GEprodnewline
\GEfirstprodline{|}{\GEkw{id}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEnt{a}  \rightarrow  \GEnt{p}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEnt{a} \, \Uparrow \, \GEnt{G}}{}{}{}{}}

\newcommand{\GEe}{
\GErulehead{\GEnt{e}  ,\ \GEnt{f}}{::=}{\GEcom{Effect cast}}\GEprodnewline
\GEfirstprodline{|}{\GEkw{id}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\Uparrow \, \GEnt{E}}{}{}{}{\GEcom{Upcast ($\GEnt{E} = \foriset{i}{n}{op_i}$)}}}

\newcommand{\GEGamma}{
\GErulehead{\Gamma}{::=}{\GEcom{Typing contexts}}\GEprodnewline
\GEfirstprodline{|}{\varnothing}{}{}{}{}\GEprodnewline
\GEprodline{|}{\Gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{A}}{}{}{}{}}

\newcommand{\GEEx}{
\GErulehead{\mathcal{E}}{::=}{\GEcom{Evaluation contexts}}\GEprodnewline
\GEfirstprodline{|}{\square}{}{}{}{}\GEprodnewline
\GEprodline{|}{\mathcal{E} \, \GEnt{M}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEnt{V} \, \mathcal{E}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\mathcal{E}  \GEsym{+}  \GEnt{M}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEnt{V}  \GEsym{+}  \mathcal{E}}{}{}{}{}\GEprodnewline
\GEprodline{|}{ \mathcal{E}  \,\MVAt\,  {\pm a} }{}{}{}{}\GEprodnewline
\GEprodline{|}{ \mathcal{E}  \,!\,  {\pm e} }{}{}{}{}\GEprodnewline
\GEprodline{|}{\mathcal{E} \, \Uparrow \, \GEnt{G}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEmv{op}  \GEsym{(}  \mathcal{E}  \GEsym{)}}{}{}{}{}\GEprodnewline
\GEprodline{|}{\GEkw{handle} \, \GEnt{H} \, \mathcal{E}}{}{}{}{}}

\newcommand{\GEgamma}{
\GErulehead{\gamma}{::=}{\GEcom{Precision contexts}}\GEprodnewline
\GEfirstprodline{|}{\varnothing}{}{}{}{}\GEprodnewline
\GEprodline{|}{\gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{a}}{}{}{}{}}

\newcommand{\GEtop}{
\GErulehead{\GEnt{top}}{::=}{}\GEprodnewline
\GEfirstprodline{|}{ \GEnt{A} }{}{}{}{}}

\newcommand{\GEgrammar}{\GEgrammartabular{
\GEM\GEinterrule
\GEV\GEinterrule
\GEH\GEinterrule
\GEopclause\GEinterrule
\GEP\GEinterrule
\GEA\GEinterrule
\GEG\GEinterrule
\GEE\GEinterrule
\GEpp\GEinterrule
\GEpa\GEinterrule
\GEpe\GEinterrule
\GEp\GEinterrule
\GEa\GEinterrule
\GEe\GEinterrule
\GEGamma\GEinterrule
\GEEx\GEinterrule
\GEgamma\GEinterrule
\GEtop\GEafterlastrule
}}

% defnss
% defns Jtype
%% defn varhastype
\newcommand{\GEdrulevarXXhere}[1]{\GEdrule[#1]{%
}{
\Gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{A}  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{A}}{%
{\GEdrulename{var\_here}}{}%
}}


\newcommand{\GEdrulevarXXthere}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{A}}%
\GEpremise{ \GEmv{x}  \neq  \GEmv{y} }%
}{
\Gamma  \GEsym{,}  \GEmv{y}  \GEsym{:}  \GEnt{B}  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{A}}{%
{\GEdrulename{var\_there}}{}%
}}

\newcommand{\GEdefnvarhastype}[1]{\begin{GEdefnblock}[#1]{$\Gamma  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{A}$}{\GEcom{in context $\Gamma$, $\GEmv{x}$ has type $\GEnt{A}$}}
\GEusedrule{\GEdrulevarXXhere{}}
\GEusedrule{\GEdrulevarXXthere{}}
\end{GEdefnblock}}

%% defn hastype
\newcommand{\GEdruletypeXXvar}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{A}}%
}{
\Gamma  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_var}}{}%
}}


\newcommand{\GEdruletypeXXapp}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \vdash  \GEnt{N}  \GEsym{:}  \GEsym{(}  \GEnt{A}  \rightarrow  \GEnt{B}  \,!\,  \GEnt{E}  \GEsym{)}  \,!\,  \GEnt{E}}%
\GEpremise{\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{E}}%
}{
\Gamma  \vdash  \GEnt{N} \, \GEnt{M}  \GEsym{:}  \GEnt{B}  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_app}}{}%
}}


\newcommand{\GEdruletypeXXabs}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{A}  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{B}  \,!\,  \GEnt{E}}%
}{
\Gamma  \vdash  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \GEsym{:}  \GEsym{(}  \GEnt{A}  \rightarrow  \GEnt{B}  \,!\,  \GEnt{E}  \GEsym{)}  \,!\,  \GEnt{F}}{%
{\GEdrulename{type\_abs}}{}%
}}


\newcommand{\GEdruletypeXXkon}[1]{\GEdrule[#1]{%
\GEpremise{ \GEmv{k}  \in \llbracket  \kappa  \rrbracket }%
}{
\Gamma  \vdash  \GEmv{k}  \GEsym{:}  \kappa  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_kon}}{}%
}}


\newcommand{\GEdruletypeXXprim}[1]{\GEdrule[#1]{%
\GEpremise{ \mathbf{typeof}(+) = ( \kappa  \to  \kappa'  \to  \kappa'' ) }%
\GEpremise{\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \kappa  \,!\,  \GEnt{E}}%
\GEpremise{\Gamma  \vdash  \GEnt{N}  \GEsym{:}  \kappa'  \,!\,  \GEnt{E}}%
}{
\Gamma  \vdash  \GEnt{M}  \GEsym{+}  \GEnt{N}  \GEsym{:}  \kappa''  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_prim}}{}%
}}


\newcommand{\GEdruletypeXXunit}[1]{\GEdrule[#1]{%
}{
\Gamma  \vdash  \GEsym{()}  \GEsym{:}  \GEkw{unit}  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_unit}}{}%
}}


\newcommand{\GEdruletypeXXcast}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{E}}%
\GEpremise{{\pm a}  \GEsym{:}  \GEnt{A}  \Rightarrow  \GEnt{B}}%
}{
\Gamma  \vdash   \GEnt{M}  \,\MVAt\,  {\pm a}   \GEsym{:}  \GEnt{B}  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_cast}}{}%
}}


\newcommand{\GEdruletypeXXecast}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{E}}%
\GEpremise{{\pm e}  \GEsym{:}  \GEnt{E}  \Rightarrow  \GEnt{F}}%
}{
\Gamma  \vdash   \GEnt{M}  \,!\,  {\pm e}   \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{F}}{%
{\GEdrulename{type\_ecast}}{}%
}}


\newcommand{\GEdruletypeXXbox}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{G}  \,!\,  \GEnt{E}}%
}{
\Gamma  \vdash  \GEnt{M} \, \Uparrow \, \GEnt{G}  \GEsym{:}  \star  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_box}}{}%
}}


\newcommand{\GEdruletypeXXblame}[1]{\GEdrule[#1]{%
}{
\Gamma  \vdash  \GEkw{blame}  \GEsym{:}  \GEnt{P}}{%
{\GEdrulename{type\_blame}}{}%
}}


\newcommand{\GEdruletypeXXop}[1]{\GEdrule[#1]{%
\GEpremise{ \mathbf{sig}( \GEmv{op} ) =  \GEnt{A}  \to  \GEnt{B} }%
\GEpremise{\GEmv{op} \, \in \, \GEnt{E}}%
\GEpremise{\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{E}}%
}{
\Gamma  \vdash  \GEmv{op}  \GEsym{(}  \GEnt{M}  \GEsym{)}  \GEsym{:}  \GEnt{B}  \,!\,  \GEnt{E}}{%
{\GEdrulename{type\_op}}{}%
}}


\newcommand{\GEdruletypeXXhandle}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \vdash  \GEnt{H}  \GEsym{:}  \GEnt{P}  \Longrightarrow  \GEnt{Q}}%
\GEpremise{\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{P}}%
}{
\Gamma  \vdash  \GEkw{handle} \, \GEnt{H} \, \GEnt{M}  \GEsym{:}  \GEnt{Q}}{%
{\GEdrulename{type\_handle}}{}%
}}

\newcommand{\GEdefnhastype}[1]{\begin{GEdefnblock}[#1]{$\Gamma  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{P}$}{\GEcom{in context $\Gamma$, $\GEnt{M}$ has type $\GEnt{P}$}}
\GEusedrule{\GEdruletypeXXvar{}}
\GEusedrule{\GEdruletypeXXapp{}}
\GEusedrule{\GEdruletypeXXabs{}}
\GEusedrule{\GEdruletypeXXkon{}}
\GEusedrule{\GEdruletypeXXprim{}}
\GEusedrule{\GEdruletypeXXunit{}}
\GEusedrule{\GEdruletypeXXcast{}}
\GEusedrule{\GEdruletypeXXecast{}}
\GEusedrule{\GEdruletypeXXbox{}}
\GEusedrule{\GEdruletypeXXblame{}}
\GEusedrule{\GEdruletypeXXop{}}
\GEusedrule{\GEdruletypeXXhandle{}}
\end{GEdefnblock}}

%% defn hashtype
\newcommand{\GEdruletypeXXhandler}[1]{\GEdrule[#1]{%
\GEpremise{\Gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{A}  \vdash  \GEnt{M}  \GEsym{:}  \GEnt{B}  \,!\,  \GEnt{F}}%
\GEpremise{ \mathbf{sig}( \GEmv{op_{\GEmv{i}}} ) =  \GEnt{A_{\GEmv{i}}}  \to  \GEnt{B_{\GEmv{i}}} }%
\GEpremise{\Gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{A_{\GEmv{i}}}  \GEsym{,}  \GEmv{k}  \GEsym{:}  \GEnt{B_{\GEmv{i}}}  \rightarrow  \GEnt{B}  \,!\,  \GEnt{F}  \vdash  \GEnt{M_{\GEmv{i}}}  \GEsym{:}  \GEnt{B}  \,!\,  \GEnt{F}}%
\GEpremise{\GEnt{F}  \GEsym{=} \, \GEkw{ops} \, \GEsym{+}  \GEnt{E}}%
}{
\Gamma  \vdash  \GEkw{return} \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \GEsym{;}  \GEmv{op_{{\mathrm{1}}}} \, \GEmv{x} \, \GEmv{k}  \GEsym{.}  \GEnt{M_{{\mathrm{1}}}} \, .. \, \GEmv{op_{\GEmv{n}}} \, \GEmv{x} \, \GEmv{k}  \GEsym{.}  \GEnt{M_{\GEmv{n}}}  \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{E}  \Longrightarrow  \GEnt{B}  \,!\,  \GEnt{F}}{%
{\GEdrulename{type\_handler}}{}%
}}

\newcommand{\GEdefnhashtype}[1]{\begin{GEdefnblock}[#1]{$\Gamma  \vdash  \GEnt{H}  \GEsym{:}  \GEnt{P}  \Longrightarrow  \GEnt{Q}$}{\GEcom{in context $\Gamma$, $\GEnt{H}$ has type $\GEnt{P} \Longrightarrow \GEnt{Q}$}}
\GEusedrule{\GEdruletypeXXhandler{}}
\end{GEdefnblock}}

%% defn effadd
\newcommand{\GEdruleeffaddXXany}[1]{\GEdrule[#1]{%
}{
\mbox{\tiny\FiveStarOpen}  \GEsym{=} \, \GEkw{ops} \, \GEsym{+}  \mbox{\tiny\FiveStarOpen}}{%
{\GEdrulename{effadd\_any}}{}%
}}


\newcommand{\GEdruleeffaddXXconcat}[1]{\GEdrule[#1]{%
\GEpremise{\texttt{TODO }}%
}{
\GEnt{F}  \GEsym{=} \, \GEkw{ops} \, \GEsym{+}  \GEnt{E}}{%
{\GEdrulename{effadd\_concat}}{}%
}}

\newcommand{\GEdefneffadd}[1]{\begin{GEdefnblock}[#1]{$\GEnt{F}  \GEsym{=} \, \GEkw{ops} \, \GEsym{+}  \GEnt{E}$}{\GEcom{effect addition}}
\GEusedrule{\GEdruleeffaddXXany{}}
\GEusedrule{\GEdruleeffaddXXconcat{}}
\end{GEdefnblock}}

%% defn pphastype
\newcommand{\GEdruleptypeXXplus}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{p}  \GEsym{:}  \GEnt{P}  \le  \GEnt{Q}}%
}{
\GEsym{+}  \GEnt{p}  \GEsym{:}  \GEnt{P}  \Rightarrow  \GEnt{Q}}{%
{\GEdrulename{ptype\_plus}}{}%
}}


\newcommand{\GEdruleptypeXXminus}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{p}  \GEsym{:}  \GEnt{Q}  \le  \GEnt{P}}%
}{
\GEsym{-}  \GEnt{p}  \GEsym{:}  \GEnt{P}  \Rightarrow  \GEnt{Q}}{%
{\GEdrulename{ptype\_minus}}{}%
}}

\newcommand{\GEdefnpphastype}[1]{\begin{GEdefnblock}[#1]{${\pm p}  \GEsym{:}  \GEnt{P}  \Rightarrow  \GEnt{Q}$}{\GEcom{${\pm p}$ has type $\GEnt{P} \Rightarrow \GEnt{Q}$}}
\GEusedrule{\GEdruleptypeXXplus{}}
\GEusedrule{\GEdruleptypeXXminus{}}
\end{GEdefnblock}}

%% defn pahastype
\newcommand{\GEdruleatypeXXplus}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{a}  \GEsym{:}  \GEnt{A}  \le  \GEnt{B}}%
}{
\GEsym{+}  \GEnt{a}  \GEsym{:}  \GEnt{A}  \Rightarrow  \GEnt{B}}{%
{\GEdrulename{atype\_plus}}{}%
}}


\newcommand{\GEdruleatypeXXminus}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{a}  \GEsym{:}  \GEnt{B}  \le  \GEnt{A}}%
}{
\GEsym{-}  \GEnt{a}  \GEsym{:}  \GEnt{A}  \Rightarrow  \GEnt{B}}{%
{\GEdrulename{atype\_minus}}{}%
}}

\newcommand{\GEdefnpahastype}[1]{\begin{GEdefnblock}[#1]{${\pm a}  \GEsym{:}  \GEnt{A}  \Rightarrow  \GEnt{B}$}{\GEcom{${\pm a}$ has type $\GEnt{A} \Rightarrow \GEnt{B}$}}
\GEusedrule{\GEdruleatypeXXplus{}}
\GEusedrule{\GEdruleatypeXXminus{}}
\end{GEdefnblock}}

%% defn pehastype
\newcommand{\GEdruleetypeXXplus}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{e}  \GEsym{:}  \GEnt{E}  \le  \GEnt{F}}%
}{
\GEsym{+}  \GEnt{e}  \GEsym{:}  \GEnt{E}  \Rightarrow  \GEnt{F}}{%
{\GEdrulename{etype\_plus}}{}%
}}


\newcommand{\GEdruleetypeXXminus}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{e}  \GEsym{:}  \GEnt{F}  \le  \GEnt{E}}%
}{
\GEsym{-}  \GEnt{e}  \GEsym{:}  \GEnt{E}  \Rightarrow  \GEnt{F}}{%
{\GEdrulename{etype\_minus}}{}%
}}

\newcommand{\GEdefnpehastype}[1]{\begin{GEdefnblock}[#1]{${\pm e}  \GEsym{:}  \GEnt{E}  \Rightarrow  \GEnt{F}$}{\GEcom{${\pm e}$ has type $\GEnt{E} \Rightarrow \GEnt{F}$}}
\GEusedrule{\GEdruleetypeXXplus{}}
\GEusedrule{\GEdruleetypeXXminus{}}
\end{GEdefnblock}}

%% defn phastype
\newcommand{\GEdruleptypeXXdirt}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{a}  \GEsym{:}  \GEnt{A}  \le  \GEnt{A'}}%
\GEpremise{\GEnt{e}  \GEsym{:}  \GEnt{E}  \le  \GEnt{E'}}%
}{
\GEnt{a}  \,!\,  \GEnt{e}  \GEsym{:}  \GEnt{A}  \,!\,  \GEnt{E}  \le  \GEnt{A'}  \,!\,  \GEnt{E'}}{%
{\GEdrulename{ptype\_dirt}}{}%
}}

\newcommand{\GEdefnphastype}[1]{\begin{GEdefnblock}[#1]{$\GEnt{p}  \GEsym{:}  \GEnt{P}  \le  \GEnt{P'}$}{\GEcom{$\GEnt{p}$ is evidence that $\GEnt{P}$ is more precise than $\GEnt{P'}$}}
\GEusedrule{\GEdruleptypeXXdirt{}}
\end{GEdefnblock}}

%% defn ahastype
\newcommand{\GEdruleatypeXXid}[1]{\GEdrule[#1]{%
}{
\GEkw{id}  \GEsym{:}  \GEnt{A}  \le  \GEnt{A}}{%
{\GEdrulename{atype\_id}}{}%
}}


\newcommand{\GEdruleatypeXXarr}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{a}  \GEsym{:}  \GEnt{A}  \le  \GEnt{A'}}%
\GEpremise{\GEnt{p}  \GEsym{:}  \GEnt{P}  \le  \GEnt{P'}}%
}{
\GEnt{a}  \rightarrow  \GEnt{p}  \GEsym{:}  \GEnt{A}  \rightarrow  \GEnt{P}  \le  \GEnt{A'}  \rightarrow  \GEnt{P'}}{%
{\GEdrulename{atype\_arr}}{}%
}}


\newcommand{\GEdruleatypeXXbox}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{a}  \GEsym{:}  \GEnt{A}  \le  \GEnt{G}}%
}{
\GEnt{a} \, \Uparrow \, \GEnt{G}  \GEsym{:}  \GEnt{A}  \le  \star}{%
{\GEdrulename{atype\_box}}{}%
}}

\newcommand{\GEdefnahastype}[1]{\begin{GEdefnblock}[#1]{$\GEnt{a}  \GEsym{:}  \GEnt{A}  \le  \GEnt{A'}$}{\GEcom{$\GEnt{a}$ is evidence that $\GEnt{A}$ is more precise than $\GEnt{A'}$}}
\GEusedrule{\GEdruleatypeXXid{}}
\GEusedrule{\GEdruleatypeXXarr{}}
\GEusedrule{\GEdruleatypeXXbox{}}
\end{GEdefnblock}}

%% defn ehastype
\newcommand{\GEdruleetypeXXid}[1]{\GEdrule[#1]{%
}{
\GEkw{id}  \GEsym{:}  \GEnt{E}  \le  \GEnt{E}}{%
{\GEdrulename{etype\_id}}{}%
}}


\newcommand{\GEdruleetypeXXup}[1]{\GEdrule[#1]{%
}{
\Uparrow \, \GEnt{E}  \GEsym{:}  \GEnt{E}  \le  \mbox{\tiny\FiveStarOpen}}{%
{\GEdrulename{etype\_up}}{}%
}}

\newcommand{\GEdefnehastype}[1]{\begin{GEdefnblock}[#1]{$\GEnt{e}  \GEsym{:}  \GEnt{E}  \le  \GEnt{E'}$}{\GEcom{$\GEnt{e}$ is evidence that $\GEnt{E}$ is more precise than $\GEnt{E'}$}}
\GEusedrule{\GEdruleetypeXXid{}}
\GEusedrule{\GEdruleetypeXXup{}}
\end{GEdefnblock}}

%% defn opin
\newcommand{\GEdruleopXXinXXstar}[1]{\GEdrule[#1]{%
}{
\GEmv{op} \, \in \, \mbox{\tiny\FiveStarOpen}}{%
{\GEdrulename{op\_in\_star}}{}%
}}


\newcommand{\GEdruleopXXinXXops}[1]{\GEdrule[#1]{%
}{
\GEmv{op_{\GEmv{i}}} \, \in \,  \foriset{i}{n}{op_i} }{%
{\GEdrulename{op\_in\_ops}}{}%
}}

\newcommand{\GEdefnopin}[1]{\begin{GEdefnblock}[#1]{$\GEmv{op} \, \in \, \GEnt{E}$}{\GEcom{operation $\GEmv{op}$ is a member of effect $\GEnt{E}$}}
\GEusedrule{\GEdruleopXXinXXstar{}}
\GEusedrule{\GEdruleopXXinXXops{}}
\end{GEdefnblock}}


\newcommand{\GEdefnsJtype}{
\GEdefnvarhastype{}\GEdefnhastype{}\GEdefnhashtype{}\GEdefneffadd{}\GEdefnpphastype{}\GEdefnpahastype{}\GEdefnpehastype{}\GEdefnphastype{}\GEdefnahastype{}\GEdefnehastype{}\GEdefnopin{}}

% defns Jred
%% defn red
\newcommand{\GEdrulebeta}[1]{\GEdrule[#1]{%
}{
\GEsym{(}  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{N}  \GEsym{)} \, \GEnt{V}  \longrightarrow  \GEnt{N}  \GEsym{[}  \GEnt{V}  \GEsym{/}  \GEmv{x}  \GEsym{]}}{%
{\GEdrulename{beta}}{}%
}}


\newcommand{\GEdruledelta}[1]{\GEdrule[#1]{%
\GEpremise{ \GEmv{k''}  = \llbracket  \GEmv{k}  +  \GEmv{k'}  \rrbracket }%
}{
\GEmv{k}  \GEsym{+}  \GEmv{k'}  \longrightarrow  \GEmv{k''}}{%
{\GEdrulename{delta}}{}%
}}


\newcommand{\GEdrulecastXXid}[1]{\GEdrule[#1]{%
}{
 \GEnt{V}  \,\MVAt\,   {\pm  \GEkw{id} }    \longrightarrow  \GEnt{V}}{%
{\GEdrulename{cast\_id}}{}%
}}


\newcommand{\GEdrulecastXXwrap}[1]{\GEdrule[#1]{%
}{
 \GEsym{(}  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \GEsym{)}  \,\MVAt\,   {\pm  \GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{e}  \GEsym{)} }    \longrightarrow  \lambda \, \GEmv{x}  \GEsym{.}   \GEsym{(}   \GEsym{(}  \GEnt{M} \, \GEsym{(}   \GEmv{x}  \,\MVAt\,   {\mp  \GEnt{a} }    \GEsym{)}  \GEsym{)}  \,\MVAt\,   {\pm  \GEnt{b} }    \GEsym{)}  \,!\,   {\pm  \GEnt{e} }  }{%
{\GEdrulename{cast\_wrap}}{}%
}}


\newcommand{\GEdrulecastXXexpand}[1]{\GEdrule[#1]{%
}{
 \GEnt{V}  \,\MVAt\,  \GEsym{+}  \GEsym{(}  \GEnt{a} \, \Uparrow \, \GEnt{G}  \GEsym{)}   \longrightarrow  \GEsym{(}   \GEnt{V}  \,\MVAt\,  \GEsym{+}  \GEnt{a}   \GEsym{)} \, \Uparrow \, \GEnt{G}}{%
{\GEdrulename{cast\_expand}}{}%
}}


\newcommand{\GEdrulecastXXcollapse}[1]{\GEdrule[#1]{%
}{
 \GEsym{(}  \GEnt{V} \, \Uparrow \, \GEnt{G}  \GEsym{)}  \,\MVAt\,  \GEsym{-}  \GEsym{(}  \GEnt{a} \, \Uparrow \, \GEnt{G}  \GEsym{)}   \longrightarrow   \GEnt{V}  \,\MVAt\,  \GEsym{-}  \GEnt{a} }{%
{\GEdrulename{cast\_collapse}}{}%
}}


\newcommand{\GEdrulecastXXcollide}[1]{\GEdrule[#1]{%
\GEpremise{ \GEnt{G}  \neq  \GEnt{G'} }%
}{
 \GEsym{(}  \GEnt{V} \, \Uparrow \, \GEnt{G'}  \GEsym{)}  \,\MVAt\,  \GEsym{-}  \GEsym{(}  \GEnt{a} \, \Uparrow \, \GEnt{G}  \GEsym{)}   \longrightarrow  \GEkw{blame}}{%
{\GEdrulename{cast\_collide}}{}%
}}


\newcommand{\GEdrulecastXXopXXblame}[1]{\GEdrule[#1]{%
\GEpremise{ \GEmv{op}  \not\in \mathbf{bound}( \mathcal{E} ) }%
\GEpremise{ \GEmv{op}  \in \mathbf{bound}(  {\pm  \GEnt{e} }  ) }%
}{
 \GEsym{(}  \mathcal{E}  \GEsym{[}  \GEmv{op}  \GEsym{(}  \GEnt{V}  \GEsym{)}  \GEsym{]}  \GEsym{)}  \,!\,   {\pm  \GEnt{e} }    \longrightarrow  \GEkw{blame}}{%
{\GEdrulename{cast\_op\_blame}}{}%
}}


\newcommand{\GEdrulehandleXXop}[1]{\GEdrule[#1]{%
\GEpremise{ \GEmv{op}  \not\in \mathbf{bound}( \mathcal{E} ) }%
\GEpremise{ \GEmv{op}  \in \mathbf{bound}( \GEnt{H} ) }%
}{
\GEkw{handle} \, \GEnt{H} \, \mathcal{E}  \GEsym{[}  \GEmv{op}  \GEsym{(}  \GEnt{V}  \GEsym{)}  \GEsym{]}  \longrightarrow   \GEnt{H} _{ \GEmv{op} }   \GEsym{[}  \GEnt{V}  \GEsym{/}  \GEmv{x}  \GEsym{]}  \GEsym{[}  \GEsym{(}  \lambda \, \GEmv{y}  \GEsym{.}  \GEkw{handle} \, \GEnt{H} \, \mathcal{E}  \GEsym{[}  \GEmv{y}  \GEsym{]}  \GEsym{)}  \GEsym{/}  \GEmv{k}  \GEsym{]}}{%
{\GEdrulename{handle\_op}}{}%
}}


\newcommand{\GEdrulehandleXXreturn}[1]{\GEdrule[#1]{%
}{
\GEkw{handle} \, \GEnt{H} \, \GEnt{V}  \longrightarrow   \GEnt{H} ^{\mathbf{ret} }   \GEsym{[}  \GEnt{V}  \GEsym{/}  \GEmv{x}  \GEsym{]}}{%
{\GEdrulename{handle\_return}}{}%
}}

\newcommand{\GEdefnred}[1]{\begin{GEdefnblock}[#1]{$\GEnt{M}  \longrightarrow  \GEnt{N}$}{}
\GEusedrule{\GEdrulebeta{}}
\GEusedrule{\GEdruledelta{}}
\GEusedrule{\GEdrulecastXXid{}}
\GEusedrule{\GEdrulecastXXwrap{}}
\GEusedrule{\GEdrulecastXXexpand{}}
\GEusedrule{\GEdrulecastXXcollapse{}}
\GEusedrule{\GEdrulecastXXcollide{}}
\GEusedrule{\GEdrulecastXXopXXblame{}}
\GEusedrule{\GEdrulehandleXXop{}}
\GEusedrule{\GEdrulehandleXXreturn{}}
\end{GEdefnblock}}

%% defn reds
\newcommand{\GEdruleredsXXrefl}[1]{\GEdrule[#1]{%
}{
\GEnt{M}  \longrightarrow^*  \GEnt{M}}{%
{\GEdrulename{reds\_refl}}{}%
}}


\newcommand{\GEdruleredsXXtrans}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{L}  \longrightarrow^*  \GEnt{M}}%
\GEpremise{\GEnt{M}  \longrightarrow^*  \GEnt{N}}%
}{
\GEnt{L}  \longrightarrow^*  \GEnt{N}}{%
{\GEdrulename{reds\_trans}}{}%
}}


\newcommand{\GEdruleredsXXred}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{M}  \longrightarrow  \GEnt{N}}%
}{
\GEnt{M}  \longrightarrow^*  \GEnt{N}}{%
{\GEdrulename{reds\_red}}{}%
}}

\newcommand{\GEdefnreds}[1]{\begin{GEdefnblock}[#1]{$\GEnt{M}  \longrightarrow^*  \GEnt{N}$}{}
\GEusedrule{\GEdruleredsXXrefl{}}
\GEusedrule{\GEdruleredsXXtrans{}}
\GEusedrule{\GEdruleredsXXred{}}
\end{GEdefnblock}}

%% defn split
\newcommand{\GEdrulesplitXXid}[1]{\GEdrule[#1]{%
}{
\GEkw{id}  \sim  \GEsym{(}  \GEkw{id}  \rightarrow  \GEkw{id}  \,!\,  \GEkw{id}  \GEsym{)}}{%
{\GEdrulename{split\_id}}{}%
}}


\newcommand{\GEdrulesplitXXarr}[1]{\GEdrule[#1]{%
}{
\GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{e}  \GEsym{)}  \sim  \GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{e}  \GEsym{)}}{%
{\GEdrulename{split\_arr}}{}%
}}

\newcommand{\GEdefnsplit}[1]{\begin{GEdefnblock}[#1]{$\GEnt{a_{{\mathrm{0}}}}  \sim  \GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{e}  \GEsym{)}$}{}
\GEusedrule{\GEdrulesplitXXid{}}
\GEusedrule{\GEdrulesplitXXarr{}}
\end{GEdefnblock}}

%% defn prec
\newcommand{\GEdruleprecXXvar}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{a}}%
}{
\gamma  \vdash  \GEmv{x}  \le  \GEmv{x}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_var}}{}%
}}


\newcommand{\GEdruleprecXXapp}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{N}  \le  \GEnt{N'}  \GEsym{:}  \GEnt{a_{{\mathrm{0}}}}  \,!\,  \GEnt{e}}%
\GEpremise{\GEnt{a_{{\mathrm{0}}}}  \sim  \GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{e}  \GEsym{)}}%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \GEnt{N} \, \GEnt{M}  \le  \GEnt{N} \, \GEnt{M'}  \GEsym{:}  \GEnt{b}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_app}}{}%
}}


\newcommand{\GEdruleprecXXabs}[1]{\GEdrule[#1]{%
\GEpremise{\GEnt{a_{{\mathrm{0}}}}  \sim  \GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{e}  \GEsym{)}}%
\GEpremise{\gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{a}  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{b}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \le  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M'}  \GEsym{:}  \GEnt{a_{{\mathrm{0}}}}  \,!\,  \GEnt{f}}{%
{\GEdrulename{prec\_abs}}{}%
}}


\newcommand{\GEdruleprecXXkon}[1]{\GEdrule[#1]{%
}{
\gamma  \vdash  \GEmv{k}  \le  \GEmv{k}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_kon}}{}%
}}


\newcommand{\GEdruleprecXXprim}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}%
\GEpremise{\gamma  \vdash  \GEnt{N}  \le  \GEnt{N'}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \GEnt{M}  \GEsym{+}  \GEnt{N}  \le  \GEnt{M'}  \GEsym{+}  \GEnt{N'}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_prim}}{}%
}}


\newcommand{\GEdruleprecXXcastXXleft}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}}%
\GEpremise{ \mathbf{commutes}^L(  {\pm  \GEnt{b} }  ,  \GEnt{a} ,  \GEnt{b'} ) }%
}{
\gamma  \vdash  \GEsym{(}   \GEnt{M}  \,\MVAt\,   {\pm  \GEnt{b} }    \GEsym{)}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{b'}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_cast\_left}}{}%
}}


\newcommand{\GEdruleprecXXcastXXright}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}}%
\GEpremise{ \mathbf{commutes}^R( \GEnt{a} ,   {\pm  \GEnt{b'} }  ,  \GEnt{b} ) }%
}{
\gamma  \vdash  \GEnt{M}  \le  \GEsym{(}   \GEnt{M'}  \,\MVAt\,   {\pm  \GEnt{b'} }    \GEsym{)}  \GEsym{:}  \GEnt{b}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_cast\_right}}{}%
}}


\newcommand{\GEdruleprecXXecastXXleft}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \GEsym{(}   \GEnt{M}  \,!\,   {\pm  \GEnt{f} }    \GEsym{)}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{f'}}{%
{\GEdrulename{prec\_ecast\_left}}{}%
}}


\newcommand{\GEdruleprecXXecastXXright}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \GEnt{M}  \le  \GEsym{(}   \GEnt{M'}  \,!\,   {\pm  \GEnt{f'} }    \GEsym{)}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{f}}{%
{\GEdrulename{prec\_ecast\_right}}{}%
}}


\newcommand{\GEdruleprecXXbox}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \GEsym{(}  \GEnt{M} \, \Uparrow \, \GEnt{G}  \GEsym{)}  \le  \GEsym{(}  \GEnt{M'} \, \Uparrow \, \GEnt{G}  \GEsym{)}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_box}}{}%
}}


\newcommand{\GEdruleprecXXboxXXright}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \GEnt{M}  \le  \GEsym{(}  \GEnt{M'} \, \Uparrow \, \GEnt{G}  \GEsym{)}  \GEsym{:}  \GEsym{(}  \GEnt{a} \, \Uparrow \, \GEnt{G}  \GEsym{)}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_box\_right}}{}%
}}


\newcommand{\GEdruleprecXXblame}[1]{\GEdrule[#1]{%
}{
\gamma  \vdash  \GEkw{blame}  \le  \GEnt{M}  \GEsym{:}  \GEnt{p}}{%
{\GEdrulename{prec\_blame}}{}%
}}


\newcommand{\GEdruleprecXXwrapXXleft}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \le  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M'}  \GEsym{:}  \GEnt{c'}  \,!\,  \GEnt{e}}%
\GEpremise{ \mathbf{commutes}^L(  {\pm  \GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{f}  \GEsym{)} }  ,  \GEnt{c} ,  \GEnt{c'} ) }%
}{
\gamma  \vdash  \GEsym{(}  \lambda \, \GEmv{x}  \GEsym{.}    \GEsym{(}  \GEnt{M} \, \GEsym{(}   \GEmv{x}  \,\MVAt\,   {\mp  \GEnt{a} }    \GEsym{)}  \GEsym{)}  \,\MVAt\,   {\pm  \GEnt{b} }    \,!\,   {\pm  \GEnt{f} }    \GEsym{)}  \le  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M'}  \GEsym{:}  \GEnt{c}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_wrap\_left}}{}%
}}


\newcommand{\GEdruleprecXXwrapXXright}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \le  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M'}  \GEsym{:}  \GEnt{c}  \,!\,  \GEnt{e}}%
\GEpremise{ \mathbf{commutes}^R( \GEnt{c} ,   {\pm  \GEsym{(}  \GEnt{a}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{f}  \GEsym{)} }  ,  \GEnt{c'} ) }%
}{
\gamma  \vdash  \lambda \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \le  \GEsym{(}  \lambda \, \GEmv{x}  \GEsym{.}    \GEsym{(}  \GEnt{M'} \, \GEsym{(}   \GEmv{x}  \,\MVAt\,   {\mp  \GEnt{a} }    \GEsym{)}  \GEsym{)}  \,\MVAt\,   {\pm  \GEnt{b} }    \,!\,   {\pm  \GEnt{f} }    \GEsym{)}  \GEsym{:}  \GEnt{c'}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_wrap\_right}}{}%
}}


\newcommand{\GEdruleprecXXop}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}%
}{
\gamma  \vdash  \GEmv{op}  \GEsym{(}  \GEnt{M}  \GEsym{)}  \le  \GEmv{op}  \GEsym{(}  \GEnt{M'}  \GEsym{)}  \GEsym{:}  \GEkw{id}  \,!\,  \GEnt{e}}{%
{\GEdrulename{prec\_op}}{}%
}}


\newcommand{\GEdruleprecXXhandle}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{p}}%
\GEpremise{\gamma  \vdash  \GEnt{H}  \le  \GEnt{H'}  \GEsym{:}  \GEnt{p}  \Longrightarrow  \GEnt{q}}%
}{
\gamma  \vdash  \GEkw{handle} \, \GEnt{H} \, \GEnt{M}  \le  \GEkw{handle} \, \GEnt{H'} \, \GEnt{M'}  \GEsym{:}  \GEnt{q}}{%
{\GEdrulename{prec\_handle}}{}%
}}

\newcommand{\GEdefnprec}[1]{\begin{GEdefnblock}[#1]{$\gamma  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{p}$}{\GEcom{$\GEnt{M}$ is more precise than $\GEnt{M'}$ with type-precision $\GEnt{p}$}}
\GEusedrule{\GEdruleprecXXvar{}}
\GEusedrule{\GEdruleprecXXapp{}}
\GEusedrule{\GEdruleprecXXabs{}}
\GEusedrule{\GEdruleprecXXkon{}}
\GEusedrule{\GEdruleprecXXprim{}}
\GEusedrule{\GEdruleprecXXcastXXleft{}}
\GEusedrule{\GEdruleprecXXcastXXright{}}
\GEusedrule{\GEdruleprecXXecastXXleft{}}
\GEusedrule{\GEdruleprecXXecastXXright{}}
\GEusedrule{\GEdruleprecXXbox{}}
\GEusedrule{\GEdruleprecXXboxXXright{}}
\GEusedrule{\GEdruleprecXXblame{}}
\GEusedrule{\GEdruleprecXXwrapXXleft{}}
\GEusedrule{\GEdruleprecXXwrapXXright{}}
\GEusedrule{\GEdruleprecXXop{}}
\GEusedrule{\GEdruleprecXXhandle{}}
\end{GEdefnblock}}

%% defn hprec
\newcommand{\GEdruleprecXXhandler}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{a}  \vdash  \GEnt{M}  \le  \GEnt{M'}  \GEsym{:}  \GEnt{b}  \,!\,  \GEnt{f}}%
\GEpremise{\gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEkw{id}  \GEsym{,}  \GEmv{k}  \GEsym{:}  \GEkw{id}  \rightarrow  \GEnt{b}  \,!\,  \GEnt{f}  \vdash  \GEnt{M_{\GEmv{i}}}  \le  \GEnt{M'_{\GEmv{i}}}  \GEsym{:}  \GEnt{b}  \,!\,  \GEnt{f}}%
}{
\gamma  \vdash  \GEkw{return} \, \GEmv{x}  \GEsym{.}  \GEnt{M}  \GEsym{;}  \GEmv{op_{{\mathrm{1}}}} \, \GEmv{x} \, \GEmv{k}  \GEsym{.}  \GEnt{M_{{\mathrm{1}}}} \, .. \, \GEmv{op_{\GEmv{n}}} \, \GEmv{x} \, \GEmv{k}  \GEsym{.}  \GEnt{M_{\GEmv{n}}}  \le  \GEkw{return} \, \GEmv{x}  \GEsym{.}  \GEnt{M'}  \GEsym{;}  \GEmv{op_{{\mathrm{1}}}} \, \GEmv{x} \, \GEmv{k}  \GEsym{.}  \GEnt{M'_{{\mathrm{1}}}} \, .. \, \GEmv{op_{\GEmv{n}}} \, \GEmv{x} \, \GEmv{k}  \GEsym{.}  \GEnt{M'_{\GEmv{n}}}  \GEsym{:}  \GEnt{a}  \,!\,  \GEnt{e}  \Longrightarrow  \GEnt{b}  \,!\,  \GEnt{f}}{%
{\GEdrulename{prec\_handler}}{}%
}}

\newcommand{\GEdefnhprec}[1]{\begin{GEdefnblock}[#1]{$\gamma  \vdash  \GEnt{H}  \le  \GEnt{H'}  \GEsym{:}  \GEnt{p}  \Longrightarrow  \GEnt{q}$}{}
\GEusedrule{\GEdruleprecXXhandler{}}
\end{GEdefnblock}}

%% defn varprec
\newcommand{\GEdrulevarprecXXhere}[1]{\GEdrule[#1]{%
}{
\gamma  \GEsym{,}  \GEmv{x}  \GEsym{:}  \GEnt{a}  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{a}}{%
{\GEdrulename{varprec\_here}}{}%
}}


\newcommand{\GEdrulevarprecXXthere}[1]{\GEdrule[#1]{%
\GEpremise{\gamma  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{a}}%
\GEpremise{ \GEmv{x}  \neq  \GEmv{y} }%
}{
\gamma  \GEsym{,}  \GEmv{y}  \GEsym{:}  \GEnt{b}  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{a}}{%
{\GEdrulename{varprec\_there}}{}%
}}

\newcommand{\GEdefnvarprec}[1]{\begin{GEdefnblock}[#1]{$\gamma  \vdash  \GEmv{x}  \GEsym{:}  \GEnt{a}$}{}
\GEusedrule{\GEdrulevarprecXXhere{}}
\GEusedrule{\GEdrulevarprecXXthere{}}
\end{GEdefnblock}}


\newcommand{\GEdefnsJred}{
\GEdefnred{}\GEdefnreds{}\GEdefnsplit{}\GEdefnprec{}\GEdefnhprec{}\GEdefnvarprec{}}

\newcommand{\GEdefnss}{
\GEdefnsJtype
\GEdefnsJred
}

\newcommand{\GEall}{\GEmetavars\\[0pt]
\GEgrammar\\[5.0mm]
\GEdefnss}

